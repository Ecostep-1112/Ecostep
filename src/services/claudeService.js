// Claude API ì„œë¹„ìŠ¤
// ë°±ì—”ë“œ ì„œë²„ë¥¼ í†µí•´ APIë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤ (ë³´ì•ˆ)
import { CapacitorHttp } from '@capacitor/core';
import { getTodayDateString, createCacheKey, cleanOldCache } from '../utils/dateUtils';

// ì˜¤ëŠ˜ì˜ íŒì´ ì´ë¯¸ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
export const isTipGeneratedToday = () => {
  const lastGeneratedDate = localStorage.getItem('lastTipGeneratedDate');
  const todayDate = getTodayDateString();
  return lastGeneratedDate === todayDate;
};

// ì˜¤ëŠ˜ì˜ í™˜ê²½ íŒ ìƒì„± ë° ì €ì¥
export const generateDailyTip = async () => {
  try {
    const todayDate = getTodayDateString();

    // ì´ë¯¸ ì˜¤ëŠ˜ ìƒì„±í–ˆìœ¼ë©´ ìŠ¤í‚µ
    if (isTipGeneratedToday()) {
      console.log('ì˜¤ëŠ˜ì˜ íŒì´ ì´ë¯¸ ìƒì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.');
      return;
    }

    console.log('ì˜¤ëŠ˜ì˜ ìƒˆë¡œìš´ íŒ ìƒì„± ì¤‘...');

    // ğŸ§¹ ì˜¤ë˜ëœ íŒ ìºì‹œ ì •ë¦¬ (1ì¼ ì´ìƒ ëœ ìºì‹œ ì‚­ì œ)
    cleanOldCache('env-tip', 1);
    cleanOldCache('currentDailyTip', 1);

    // ì €ì¥ëœ ì¹´í…Œê³ ë¦¬ ë˜ëŠ” ê¸°ë³¸ê°’ ì‚¬ìš©
    const category = localStorage.getItem('tipCategory') || 'ëœë¤';

    // ì €ì¥ëœ ì–¸ì–´ ì„¤ì • ê°€ì ¸ì˜¤ê¸° (ê¸°ë³¸ê°’: í•œêµ­ì–´)
    const appSettings = JSON.parse(localStorage.getItem('app-settings') || '{}');
    const language = appSettings.language || 'í•œêµ­ì–´';

    // ë°±ì—”ë“œ ì„œë²„ë¥¼ í†µí•´ Claude API í˜¸ì¶œ
    const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5176';
    const response = await CapacitorHttp.post({
      url: `${API_URL}/api/environmental-tip`,
      headers: {
        'Content-Type': 'application/json',
      },
      data: {
        category: category === 'ëœë¤' ? null : category,
        language: language
      }
    });

    const tipData = response.data;

    // localStorageì— ì €ì¥
    localStorage.setItem('currentDailyTip', JSON.stringify(tipData));
    localStorage.setItem('lastTipGeneratedDate', todayDate);

    console.log('ì˜¤ëŠ˜ì˜ íŒ ìƒì„± ì™„ë£Œ:', tipData.title);
  } catch (error) {
    console.error('ì¼ì¼ íŒ ìƒì„± ì‹¤íŒ¨:', error);
    // ì‹¤íŒ¨í•´ë„ ê¸°ë³¸ íŒ ì €ì¥
    const fallbackTip = {
      id: Date.now(),
      title: 'í™˜ê²½ ë³´í˜¸ ì‹¤ì²œí•˜ê¸°',
      preview: 'ì‘ì€ ì‹¤ì²œì´ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤',
      content: 'ì¼íšŒìš©í’ˆ ì‚¬ìš©ì„ ì¤„ì´ê³ , ì¬í™œìš©ì„ ìƒí™œí™”í•˜ë©°, ì—ë„ˆì§€ë¥¼ ì ˆì•½í•˜ëŠ” ê²ƒë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”. ë§¤ì¼ ì‘ì€ ë…¸ë ¥ì´ ëª¨ì—¬ ì§€êµ¬ë¥¼ ì§€í‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      category: 'ìƒí™œ ìŠµê´€'
    };
    localStorage.setItem('currentDailyTip', JSON.stringify(fallbackTip));
    localStorage.setItem('lastTipGeneratedDate', getTodayDateString());
  }
};

// ì˜¤ëŠ˜ì˜ íŒ ê°€ì ¸ì˜¤ê¸°
export const getTodayTip = () => {
  try {
    const tipStr = localStorage.getItem('currentDailyTip');
    if (!tipStr) {
      // íŒì´ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ë°˜í™˜
      return {
        id: Date.now(),
        title: 'í™˜ê²½ ë³´í˜¸ ì‹¤ì²œí•˜ê¸°',
        preview: 'ì‘ì€ ì‹¤ì²œì´ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤',
        content: 'ì¼íšŒìš©í’ˆ ì‚¬ìš©ì„ ì¤„ì´ê³ , ì¬í™œìš©ì„ ìƒí™œí™”í•˜ë©°, ì—ë„ˆì§€ë¥¼ ì ˆì•½í•˜ëŠ” ê²ƒë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”. ë§¤ì¼ ì‘ì€ ë…¸ë ¥ì´ ëª¨ì—¬ ì§€êµ¬ë¥¼ ì§€í‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
        category: 'ìƒí™œ ìŠµê´€'
      };
    }
    return JSON.parse(tipStr);
  } catch (error) {
    console.error('íŒ ë¡œë“œ ì‹¤íŒ¨:', error);
    return {
      id: Date.now(),
      title: 'í™˜ê²½ ë³´í˜¸ ì‹¤ì²œí•˜ê¸°',
      preview: 'ì‘ì€ ì‹¤ì²œì´ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤',
      content: 'ì¼íšŒìš©í’ˆ ì‚¬ìš©ì„ ì¤„ì´ê³ , ì¬í™œìš©ì„ ìƒí™œí™”í•˜ë©°, ì—ë„ˆì§€ë¥¼ ì ˆì•½í•˜ëŠ” ê²ƒë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”. ë§¤ì¼ ì‘ì€ ë…¸ë ¥ì´ ëª¨ì—¬ ì§€êµ¬ë¥¼ ì§€í‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      category: 'ìƒí™œ ìŠµê´€'
    };
  }
};

export const generateEnvironmentalTip = async (category = null) => {
  try {
    // ğŸ§¹ ì˜¤ë˜ëœ ìºì‹œ ë¨¼ì € ì •ë¦¬
    cleanOldCache('env-tip', 1);

    // ì˜¤ëŠ˜ ë‚ ì§œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìºì‹œ í‚¤ ìƒì„±
    const cacheKey = createCacheKey('env-tip', category || 'ëœë¤');

    // ìºì‹œ í™•ì¸
    const cachedTip = localStorage.getItem(cacheKey);
    if (cachedTip) {
      console.log('ìºì‹œì—ì„œ íŒ ë¡œë“œ:', category);
      return JSON.parse(cachedTip);
    }

    console.log('ìƒˆë¡œìš´ íŒ ìƒì„± ì¤‘:', category);

    // ë°±ì—”ë“œ ì„œë²„ë¥¼ í†µí•´ Claude API í˜¸ì¶œ
    const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5176';
    const response = await fetch(`${API_URL}/api/environmental-tip`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        category: category || 'ëœë¤'
      })
    });

    if (!response.ok) {
      throw new Error('API ìš”ì²­ ì‹¤íŒ¨');
    }

    const tipData = await response.json();

    // ìºì‹œì— ì €ì¥
    localStorage.setItem(cacheKey, JSON.stringify(tipData));

    return tipData;
  } catch (error) {
    console.error('í™˜ê²½ íŒ ë¡œë“œ ì‹¤íŒ¨ - Mock ë°ì´í„° ì‚¬ìš©:', error);
    // ë°±ì—”ë“œ ì„œë²„ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì€ ê²½ìš° Mock ë°ì´í„° ì‚¬ìš©
    return generateMockTip(category, null);
  }
};

// Mock ë°ì´í„° ìƒì„± í•¨ìˆ˜ (ê°œë°œ/ì—ëŸ¬ ì‹œ ì‚¬ìš©)
const generateMockTip = (category = null, index = null) => {
  const tips = [
    // ì œë¡œì›¨ì´ìŠ¤íŠ¸ ì¹´í…Œê³ ë¦¬
    {
      title: 'ë°€ë ë© ì‚¬ìš©í•˜ê¸°',
      preview: 'ì¼íšŒìš© ë¹„ë‹ë© ëŒ€ì‹  ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë°€ë ë©ì„ ì‚¬ìš©í•´ë³´ì„¸ìš”',
      content: 'ë°€ë ë©ì€ ì²œì—° ë°€ëê³¼ ë©´ ì²œìœ¼ë¡œ ë§Œë“  ì¹œí™˜ê²½ ì‹í’ˆ í¬ì¥ì¬ì…ë‹ˆë‹¤. ë¹„ë‹ë©ê³¼ ë‹¬ë¦¬ 1ë…„ ì´ìƒ ì¬ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë©°, ì‚¬ìš© í›„ì—ëŠ” 100% ìƒë¶„í•´ë©ë‹ˆë‹¤. ì•¼ì±„, ê³¼ì¼, ë‚¨ì€ ìŒì‹ì„ ì‹¸ê±°ë‚˜ ê·¸ë¦‡ì„ ë®ì„ ë•Œ ì‚¬ìš©í•˜ì„¸ìš”. ì†ì˜ ì˜¨ê¸°ë¡œ ì‚´ì§ ëˆŒëŸ¬ì£¼ë©´ ë°€ì°©ë˜ì–´ ì‹ ì„ ë„ë¥¼ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      category: 'ì œë¡œì›¨ì´ìŠ¤íŠ¸'
    },
    {
      title: 'ì²œì—° ìˆ˜ì„¸ë¯¸ ì‚¬ìš©',
      preview: 'í”Œë¼ìŠ¤í‹± ìˆ˜ì„¸ë¯¸ ëŒ€ì‹  ì²œì—° ìˆ˜ì„¸ë¯¸ë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”',
      content: 'ìˆ˜ì„¸ë¯¸ ì—´ë§¤ë¡œ ë§Œë“  ì²œì—° ìˆ˜ì„¸ë¯¸ëŠ” í”Œë¼ìŠ¤í‹± ìˆ˜ì„¸ë¯¸ì™€ ë‹¬ë¦¬ ë¯¸ì„¸í”Œë¼ìŠ¤í‹±ì„ ë°°ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì„¤ê±°ì§€í•  ë•Œ ì„¸ì œ ì‚¬ìš©ëŸ‰ë„ ì¤„ì¼ ìˆ˜ ìˆê³ , ì‚¬ìš© í›„ì—ëŠ” í‡´ë¹„ë¡œ ë§Œë“¤ ìˆ˜ ìˆì–´ 100% ìì—° ìˆœí™˜ë©ë‹ˆë‹¤. 3-4ê°œì›”ë§ˆë‹¤ êµì²´í•˜ë©´ ìœ„ìƒì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©°, ì‚¶ì•„ì„œ ì†Œë…í•˜ë©´ ë” ì˜¤ë˜ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      category: 'ì œë¡œì›¨ì´ìŠ¤íŠ¸'
    },
    {
      title: 'ê³ ì²´ ìƒ´í‘¸ë°” ì‚¬ìš©',
      preview: 'í”Œë¼ìŠ¤í‹± ìš©ê¸° ëŒ€ì‹  ê³ ì²´ ìƒ´í‘¸ë°”ë¡œ ì „í™˜í•´ë³´ì„¸ìš”',
      content: 'ê³ ì²´ ìƒ´í‘¸ë°”ëŠ” í”Œë¼ìŠ¤í‹± ìš©ê¸°ê°€ í•„ìš” ì—†ê³ , í•œ ê°œë¡œ ì•¡ì²´ ìƒ´í‘¸ 2-3ë³‘ ë¶„ëŸ‰ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬í–‰ ì‹œ ì•¡ì²´ ì œí•œë„ ë°›ì§€ ì•Šì•„ í¸ë¦¬í•©ë‹ˆë‹¤. ì²œì—° ì„±ë¶„ìœ¼ë¡œ ë§Œë“¤ì–´ì ¸ ë‘í”¼ì—ë„ ì¢‹ê³ , ì‚¬ìš© í›„ ì¢…ì´ í¬ì¥ë§Œ ë‚¨ì•„ ì“°ë ˆê¸°ë„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      category: 'ì œë¡œì›¨ì´ìŠ¤íŠ¸'
    },
    {
      title: 'ìŠ¤í…Œì¸ë¦¬ìŠ¤ ë¹¨ëŒ€ ì‚¬ìš©',
      preview: 'ì¼íšŒìš© í”Œë¼ìŠ¤í‹± ë¹¨ëŒ€ ëŒ€ì‹  ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ìŠ¤í…Œì¸ë¦¬ìŠ¤ ë¹¨ëŒ€ë¥¼',
      content: 'ìŠ¤í…Œì¸ë¦¬ìŠ¤ ë¹¨ëŒ€ëŠ” ë°˜ì˜êµ¬ì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ë©°, ì „ìš© ì†”ë¡œ ê¹¨ë—í•˜ê²Œ ì„¸ì²™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íœ´ëŒ€ìš© íŒŒìš°ì¹˜ì™€ í•¨ê»˜ ê°€ì§€ê³  ë‹¤ë‹ˆë©´ ì¹´í˜ë‚˜ ì‹ë‹¹ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¤ë¦¬ì½˜ íŒì„ ì”Œìš°ë©´ ì•„ì´ë“¤ë„ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      category: 'ì œë¡œì›¨ì´ìŠ¤íŠ¸'
    },
    
    // ìƒí™œ ìŠµê´€ ì¹´í…Œê³ ë¦¬
    {
      title: 'ë©”ì‰¬ë°±ìœ¼ë¡œ ì¥ë³´ê¸°',
      preview: 'ê³¼ì¼ê³¼ ì±„ì†Œ êµ¬ë§¤ ì‹œ ë©”ì‰¬ë°±ì„ í™œìš©í•´ ë¹„ë‹ë´‰ì§€ë¥¼ ì¤„ì—¬ë³´ì„¸ìš”',
      content: 'ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë©”ì‰¬ë°±ì€ ê³¼ì¼ê³¼ ì±„ì†Œë¥¼ ë‹´ê¸°ì— ì™„ë²½í•©ë‹ˆë‹¤. í†µê¸°ì„±ì´ ì¢‹ì•„ ì‹ ì„ ë„ ìœ ì§€ì—ë„ ë„ì›€ì´ ë˜ê³ , ê°€ë²¼ì›Œì„œ íœ´ëŒ€í•˜ê¸°ë„ í¸í•©ë‹ˆë‹¤. ë§ˆíŠ¸ì—ì„œ ì œê³µí•˜ëŠ” ë¹„ë‹ë´‰ì§€ ëŒ€ì‹  ë©”ì‰¬ë°±ì„ ì‚¬ìš©í•˜ë©´ ì—°ê°„ ìˆ˜ë°± ê°œì˜ ë¹„ë‹ ì‚¬ìš©ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš© í›„ì—ëŠ” ì„¸íƒê¸°ì— ë„£ì–´ ê°„ë‹¨íˆ ì„¸ì²™í•  ìˆ˜ ìˆì–´ìš”.',
      category: 'ìƒí™œ ìŠµê´€'
    },
    {
      title: 'í…€ë¸”ëŸ¬ ì‚¬ìš© ìŠµê´€í™”',
      preview: 'ì¼íšŒìš© ì»µ ëŒ€ì‹  í…€ë¸”ëŸ¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ìŠµê´€ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”',
      content: 'ë§¤ì¼ ì‚¬ìš©í•˜ëŠ” ì¼íšŒìš© ì»µì„ í…€ë¸”ëŸ¬ë¡œ ë°”ê¾¸ë©´ ì—°ê°„ 300ê°œ ì´ìƒì˜ ì¼íšŒìš© ì»µì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§ì€ ì¹´í˜ì—ì„œ í…€ë¸”ëŸ¬ í• ì¸ì„ ì œê³µí•˜ë¯€ë¡œ ê²½ì œì ì´ê¸°ë„ í•©ë‹ˆë‹¤. ë³´ì˜¨ë³´ëƒ‰ ê¸°ëŠ¥ì´ ìˆëŠ” í…€ë¸”ëŸ¬ëŠ” ìŒë£Œë¥¼ ë” ì˜¤ë˜ ë§›ìˆê²Œ ì¦ê¸¸ ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.',
      category: 'ìƒí™œ ìŠµê´€'
    },
    {
      title: 'ì¥ë°”êµ¬ë‹ˆ í•­ìƒ íœ´ëŒ€',
      preview: 'ì ‘ì´ì‹ ì¥ë°”êµ¬ë‹ˆë¥¼ ê°€ë°©ì— ë„£ê³  ë‹¤ë‹ˆëŠ” ìŠµê´€ì„ ë“¤ì—¬ë³´ì„¸ìš”',
      content: 'ì‘ê²Œ ì ‘íˆëŠ” ì¥ë°”êµ¬ë‹ˆë¥¼ í•­ìƒ ê°€ë°©ì— ë„£ê³  ë‹¤ë‹ˆë©´ ê°‘ì‘ìŠ¤ëŸ¬ìš´ ì‡¼í•‘ì—ë„ ë¹„ë‹ë´‰ì§€ë¥¼ ë°›ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°©ìˆ˜ ì†Œì¬ ì¥ë°”êµ¬ë‹ˆëŠ” ì„¸ì²™ì´ ì‰½ê³  ìœ„ìƒì ì…ë‹ˆë‹¤. ì˜ˆìœ ë””ìì¸ì˜ ì¥ë°”êµ¬ë‹ˆëŠ” íŒ¨ì…˜ ì•„ì´í…œìœ¼ë¡œë„ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      category: 'ìƒí™œ ìŠµê´€'
    },
    {
      title: 'ì†ìˆ˜ê±´ ì‚¬ìš©í•˜ê¸°',
      preview: 'íœ´ì§€ ëŒ€ì‹  ì†ìˆ˜ê±´ì„ ì‚¬ìš©í•˜ëŠ” ìŠµê´€ì„ ê¸¸ëŸ¬ë³´ì„¸ìš”',
      content: 'ì†ìˆ˜ê±´ í•œ ì¥ìœ¼ë¡œ í•˜ë£¨ì— ì‚¬ìš©í•˜ëŠ” íœ´ì§€ì˜ ì–‘ì„ í¬ê²Œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë©´ ì†ìˆ˜ê±´ì€ í¡ìˆ˜ë ¥ì´ ì¢‹ê³  ì„¸íƒí•˜ë©´ ê³„ì† ì‚¬ìš©í•  ìˆ˜ ìˆì–´ ê²½ì œì ì…ë‹ˆë‹¤. ì—¬ëŸ¬ ì¥ì„ ì¤€ë¹„í•´ë‘ê³  ë§¤ì¼ ê¹¨ë—í•œ ê²ƒìœ¼ë¡œ êµì²´í•˜ë©´ ìœ„ìƒì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      category: 'ìƒí™œ ìŠµê´€'
    },
    
    // ì¬í™œìš© íŒ ì¹´í…Œê³ ë¦¬
    {
      title: 'ì»¤í”¼ ì°Œêº¼ê¸° í™œìš©ë²•',
      preview: 'ë²„ë ¤ì§€ëŠ” ì»¤í”¼ ì°Œêº¼ê¸°ë¥¼ ì²œì—° íƒˆì·¨ì œë¡œ ì¬í™œìš©í•´ë³´ì„¸ìš”',
      content: 'ì»¤í”¼ë¥¼ ë‚´ë¦¬ê³  ë‚¨ì€ ì°Œêº¼ê¸°ëŠ” í›Œë¥­í•œ ì²œì—° íƒˆì·¨ì œì…ë‹ˆë‹¤. ì˜ ë§ë¦° í›„ ë§ì‚¬ ì£¼ë¨¸ë‹ˆì— ë„£ì–´ ì‹ ë°œì¥, ëƒ‰ì¥ê³ , ì°¨ëŸ‰ì— ë‘ë©´ ëƒ„ìƒˆë¥¼ í¡ìˆ˜í•©ë‹ˆë‹¤. ë˜í•œ í•˜ìˆ˜êµ¬ì— ë¿Œë¦¬ë©´ ê¸°ë¦„ë•Œ ì œê±°ì— íš¨ê³¼ì ì´ê³ , í™”ë¶„ì— ë¿Œë¦¬ë©´ ì²œì—° ë¹„ë£Œê°€ ë©ë‹ˆë‹¤. ì¼ì£¼ì¼ì— í•œ ë²ˆì”© êµì²´í•˜ë©´ íš¨ê³¼ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      category: 'ì¬í™œìš© íŒ'
    },
    {
      title: 'í˜íŠ¸ë³‘ ì˜¬ë°”ë¥¸ ë¶„ë¦¬ë°°ì¶œ',
      preview: 'í˜íŠ¸ë³‘ì„ ì˜¬ë°”ë¥´ê²Œ ë¶„ë¦¬ë°°ì¶œí•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì„¸ìš”',
      content: 'í˜íŠ¸ë³‘ì€ ë¼ë²¨ì„ ì œê±°í•˜ê³  ë‚´ìš©ë¬¼ì„ ë¹„ìš´ í›„ ê¹¨ë—ì´ í—¹ê¶ˆì•¼ í•©ë‹ˆë‹¤. ëšœê»‘ì€ ë”°ë¡œ ë¶„ë¦¬í•˜ê³ , ëª¸ì²´ëŠ” ë°œë¡œ ë°Ÿì•„ ì••ì¶•í•˜ë©´ ë¶€í”¼ë¥¼ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íˆ¬ëª… í˜íŠ¸ë³‘ì€ ë³„ë„ ë¶„ë¦¬ë°°ì¶œí•˜ë©´ ê³ í’ˆì§ˆ ì¬í™œìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.',
      category: 'ì¬í™œìš© íŒ'
    },
    {
      title: 'ìš°ìœ íŒ© ì¬í™œìš© ë°©ë²•',
      preview: 'ìš°ìœ íŒ©ì„ ì œëŒ€ë¡œ ì¬í™œìš©í•˜ëŠ” ë°©ë²•ì„ ì‹¤ì²œí•´ë³´ì„¸ìš”',
      content: 'ìš°ìœ íŒ©ì€ ì¼ë°˜ ì¢…ì´ì™€ ë‹¤ë¥´ê²Œ ë³„ë„ë¡œ ë¶„ë¦¬ë°°ì¶œí•´ì•¼ í•©ë‹ˆë‹¤. ë‚´ìš©ë¬¼ì„ ë¹„ìš°ê³  ê¹¨ë—ì´ í—¹êµ° í›„ í¼ì³ì„œ ë§ë ¤ì£¼ì„¸ìš”. ì—¬ëŸ¬ ê°œë¥¼ ëª¨ì•„ ë¬¶ì–´ì„œ ë°°ì¶œí•˜ë©´ ìˆ˜ê±°ê°€ ìš©ì´í•©ë‹ˆë‹¤. ìš°ìœ íŒ©ì€ ê³ ê¸‰ í™”ì¥ì§€ì˜ ì›ë£Œê°€ ë˜ë¯€ë¡œ ê¹¨ë—í•˜ê²Œ ë°°ì¶œí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.',
      category: 'ì¬í™œìš© íŒ'
    },
    {
      title: 'ìœ ë¦¬ë³‘ ì¬í™œìš© íŒ',
      preview: 'ìœ ë¦¬ë³‘ì„ íš¨ê³¼ì ìœ¼ë¡œ ì¬í™œìš©í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì„¸ìš”',
      content: 'ìœ ë¦¬ë³‘ì€ ìƒ‰ìƒë³„ë¡œ ë¶„ë¦¬í•˜ë©´ ì¬í™œìš© í’ˆì§ˆì´ ë†’ì•„ì§‘ë‹ˆë‹¤. ë¼ë²¨ê³¼ ëšœê»‘ì„ ì œê±°í•˜ê³  ë‚´ìš©ë¬¼ì„ ê¹¨ë—ì´ ì”»ì–´ë‚´ì„¸ìš”. ê¹¨ì§„ ìœ ë¦¬ëŠ” ì‹ ë¬¸ì§€ì— ì‹¸ì„œ "ê¹¨ì§„ ìœ ë¦¬"ë¼ê³  í‘œì‹œí•˜ì—¬ ì•ˆì „í•˜ê²Œ ë°°ì¶œí•©ë‹ˆë‹¤. ë³´ì¦ê¸ˆ ëŒ€ìƒ ë³‘ì€ ë§ˆíŠ¸ì—ì„œ í™˜ë¶ˆë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      category: 'ì¬í™œìš© íŒ'
    },
    
    // ì—ë„ˆì§€ ì ˆì•½ ì¹´í…Œê³ ë¦¬
    {
      title: 'ëŒ€ê¸°ì „ë ¥ ì°¨ë‹¨í•˜ê¸°',
      preview: 'ë©€í‹°íƒ­ ìŠ¤ìœ„ì¹˜ë¡œ ëŒ€ê¸°ì „ë ¥ì„ ì°¨ë‹¨í•´ ì „ê¸°ë¥¼ ì ˆì•½í•˜ì„¸ìš”',
      content: 'ê°€ì „ì œí’ˆì˜ ëŒ€ê¸°ì „ë ¥ì€ ì „ì²´ ì „ë ¥ ì‚¬ìš©ëŸ‰ì˜ 10%ë¥¼ ì°¨ì§€í•©ë‹ˆë‹¤. ìŠ¤ìœ„ì¹˜ê°€ ìˆëŠ” ë©€í‹°íƒ­ì„ ì‚¬ìš©í•˜ë©´ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê°€ì „ì œí’ˆì˜ ì „ì›ì„ ì‰½ê²Œ ì°¨ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. TV, ì»´í“¨í„°, ì¶©ì „ê¸° ë“±ì„ ì‚¬ìš©í•˜ì§€ ì•Šì„ ë•ŒëŠ” ë©€í‹°íƒ­ ìŠ¤ìœ„ì¹˜ë¥¼ êº¼ë‘ì„¸ìš”. ì›” ì „ê¸°ë£Œë¥¼ 5-10% ì ˆê°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      category: 'ì—ë„ˆì§€ ì ˆì•½'
    },
    {
      title: 'LED ì „êµ¬ë¡œ êµì²´',
      preview: 'ë°±ì—´ì „êµ¬ë¥¼ LEDë¡œ êµì²´í•˜ì—¬ ì „ê¸°ë¥¼ ì ˆì•½í•´ë³´ì„¸ìš”',
      content: 'LED ì „êµ¬ëŠ” ë°±ì—´ì „êµ¬ë³´ë‹¤ 85% ì ì€ ì „ë ¥ì„ ì‚¬ìš©í•˜ë©°, ìˆ˜ëª…ë„ 25ë°° ì´ìƒ ê¹ë‹ˆë‹¤. ì´ˆê¸° ë¹„ìš©ì€ ë†’ì§€ë§Œ ì¥ê¸°ì ìœ¼ë¡œ ì „ê¸°ë£Œì™€ êµì²´ ë¹„ìš©ì„ í¬ê²Œ ì ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒ‰ì˜¨ë„ë¥¼ ì„ íƒí•  ìˆ˜ ìˆì–´ ê³µê°„ì— ë§ëŠ” ì¡°ëª… ì—°ì¶œë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.',
      category: 'ì—ë„ˆì§€ ì ˆì•½'
    },
    {
      title: 'ì—ì–´ì»¨ ì ì • ì˜¨ë„ ìœ ì§€',
      preview: 'ì—¬ë¦„ì²  ì—ì–´ì»¨ ì˜¨ë„ë¥¼ 26ë„ë¡œ ìœ ì§€í•˜ì—¬ ì—ë„ˆì§€ë¥¼ ì ˆì•½í•˜ì„¸ìš”',
      content: 'ì—ì–´ì»¨ ì„¤ì • ì˜¨ë„ë¥¼ 1ë„ ë†’ì´ë©´ ì „ë ¥ ì†Œë¹„ë¥¼ 7% ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 26-28ë„ë¥¼ ìœ ì§€í•˜ê³  ì„ í’ê¸°ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ì²´ê° ì˜¨ë„ë¥¼ ë‚®ì¶œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•„í„°ë¥¼ ì •ê¸°ì ìœ¼ë¡œ ì²­ì†Œí•˜ë©´ ëƒ‰ë°© íš¨ìœ¨ì´ ë†’ì•„ì ¸ ì „ê¸°ë¥¼ ì ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      category: 'ì—ë„ˆì§€ ì ˆì•½'
    },
    {
      title: 'ì„¸íƒê¸° ì°¬ë¬¼ ì„¸íƒ',
      preview: 'ì°¬ë¬¼ ì„¸íƒìœ¼ë¡œ ì—ë„ˆì§€ë¥¼ ì ˆì•½í•˜ê³  ì˜·ê°ë„ ë³´í˜¸í•˜ì„¸ìš”',
      content: 'ì„¸íƒê¸° ì—ë„ˆì§€ì˜ 90%ëŠ” ë¬¼ì„ ë°ìš°ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ì„¸íƒë¬¼ì€ ì°¬ë¬¼ë¡œë„ ì¶©ë¶„íˆ ê¹¨ë—í•´ì§‘ë‹ˆë‹¤. ì°¬ë¬¼ ì „ìš© ì„¸ì œë¥¼ ì‚¬ìš©í•˜ë©´ ì„¸íƒë ¥ì„ ë†’ì¼ ìˆ˜ ìˆê³ , ì˜·ê° ì†ìƒë„ ì¤„ì¼ ìˆ˜ ìˆì–´ ì˜·ì„ ë” ì˜¤ë˜ ì…ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      category: 'ì—ë„ˆì§€ ì ˆì•½'
    }
  ];

  // ì¹´í…Œê³ ë¦¬ê°€ ì§€ì •ëœ ê²½ìš° í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ íŒë§Œ í•„í„°ë§
  let filteredTips = tips;
  if (category && category !== 'ëœë¤') {
    filteredTips = tips.filter(tip => tip.category === category);
    // í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì— íŒì´ ì—†ìœ¼ë©´ ì „ì²´ íŒ ì‚¬ìš©
    if (filteredTips.length === 0) {
      filteredTips = tips;
    }
  }
  
  let selectedTip;
  let currentIndex = 0;
  
  // ì¸ë±ìŠ¤ê°€ ì§€ì •ëœ ê²½ìš° ìˆœì°¨ì ìœ¼ë¡œ ì„ íƒ, ì•„ë‹ˆë©´ ëœë¤
  if (index !== null && category !== 'ëœë¤' && category !== null) {
    // ì¸ë±ìŠ¤ê°€ ë°°ì—´ ê¸¸ì´ë¥¼ ì´ˆê³¼í•˜ë©´ ì²˜ìŒìœ¼ë¡œ ìˆœí™˜
    currentIndex = index % filteredTips.length;
    selectedTip = filteredTips[currentIndex];
  } else {
    // ëœë¤ ì„ íƒ
    const randomIndex = Math.floor(Math.random() * filteredTips.length);
    selectedTip = filteredTips[randomIndex];
    currentIndex = randomIndex;
  }
  
  return {
    id: Date.now(),
    ...selectedTip,
    currentIndex: currentIndex
  };
};

export default generateEnvironmentalTip;